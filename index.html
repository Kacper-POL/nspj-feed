<script>
    const parser = new DOMParser();
    const feedUrl = "https://nspj.bydgoszcz.pl/category/news-nspj/feed/";
    const proxyUrl = "https://corsproxy.io/?" + encodeURIComponent(feedUrl);

    fetch(proxyUrl)
        .then(response => {
            if (response.ok) return response.text();
            throw new Error('Network response was not ok.');
        })
        .then(str => {
            const xmlDoc = parser.parseFromString(str, "text/xml");
            const items = xmlDoc.querySelectorAll("item");
            const feedDiv = document.getElementById("feed");
            feedDiv.innerHTML = ""; // wyczyść "Ładowanie..."
            for (let i = 0; i < Math.min(5, items.length); i++) {
                const item = items[i];
                const title = item.querySelector("title").textContent;
                const link = item.querySelector("link").textContent;
                const pubDate = new Date(item.querySelector("pubDate").textContent);
                const formattedDate = pubDate.toLocaleDateString("pl-PL");

                const div = document.createElement("div");
                div.className = "post";
                div.innerHTML = `<div class="date">${formattedDate}</div><a href="${link}" target="_blank">${title}</a>`;
                feedDiv.appendChild(div);
            }
        })
        .catch(err => {
            document.getElementById("feed").innerText = "Nie udało się pobrać aktualności.";
            console.error(err);
        });
</script>
